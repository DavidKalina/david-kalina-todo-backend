FROM node:18-slim

WORKDIR /app

# Install OpenSSL and other required dependencies
RUN apt-get update -y && \
    apt-get install -y openssl && \
    apt-get install -y build-essential python3

# Install dependencies only when package files change
COPY package*.json ./
RUN npm install

# Install ts-node-dev globally
RUN npm install -g ts-node-dev

# Copy prisma files
COPY prisma ./prisma/

# Generate Prisma client
RUN npx prisma generate

EXPOSE 3001

# Use ts-node-dev for development
CMD ["npm", "run", "dev"]